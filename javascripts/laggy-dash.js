(function(){window.LaggyDash={}}).call(this),function(){var t,e,a=function(t,e){return function(){return t.apply(e,arguments)}},i={}.hasOwnProperty,s=function(t,e){function a(){this.constructor=t}for(var s in e)i.call(e,s)&&(t[s]=e[s]);return a.prototype=e.prototype,t.prototype=new a,t.__super__=e.prototype,t};t=window.LaggyDash,e=function(t){function e(){this.done=a(this.done,this)}return s(e,t),e.prototype.create=function(){var t,e;return this.game.stage.backgroundColor="#FFFFFF",this.labs=this.game.add.sprite(this.game.world.centerX,this.game.world.centerY,"labs"),this.labs.body=null,this.labs.scale.setTo(.4,.4),this.labs.anchor.setTo(.5,.5),this.labs.alpha=0,t=this.game.add.tween(this.labs),t.to({alpha:1},1e3,Phaser.Easing.Linear.None,!1),e=this.game.add.tween(this.labs),e.to({alpha:0},1e3,Phaser.Easing.Linear.None,!1),t.onComplete.addOnce(function(){return function(){return e.start()}}(this)),e.onComplete.addOnce(this.done),t.start()},e.prototype.destroy=function(){return destroy(this.labs)},e.prototype.done=function(){return this.game.state.start("landscape")},e}(Phaser.State),t.Splash=e}.call(this),function(){var t,e,a=function(t,e){return function(){return t.apply(e,arguments)}},i={}.hasOwnProperty,s=function(t,e){function a(){this.constructor=t}for(var s in e)i.call(e,s)&&(t[s]=e[s]);return a.prototype=e.prototype,t.prototype=new a,t.__super__=e.prototype,t};t=window.LaggyDash,e=function(t){function e(){this.done=a(this.done,this),this.showPlayer=a(this.showPlayer,this),this.jump=a(this.jump,this)}var i;return s(e,t),i=1,e.prototype.preload=function(){return window.laggydash.connect("laggydash",laggydash.game.rnd.uuid()+(":"+this.game.player_name))},e.prototype.create=function(){var t,e,a,s,n,r,o,h,d,u;for(this.game.stage.backgroundColor="#000055",this.night=this.game.add.sprite(this.game.world.centerX,this.game.world.centerY,"night"),this.night.body=null,this.night.alpha=0,this.night.anchor.setTo(.5,.5),t=this.game.add.tween(this.night),t.to({alpha:1},3e5/i,Phaser.Easing.Linear.None,!0,15e4/i,999,!0),t.start,this.sky=this.game.add.sprite(this.game.world.centerX,this.game.world.centerY,"sky"),this.sky.body=null,this.sky.alpha=1,this.sky.anchor.setTo(.5,.5),t=this.game.add.tween(this.sky),t.to({alpha:0},45e4/i,Phaser.Easing.Linear.None,!0,0,999,!0),t.start,this.sun=this.game.add.sprite(0,0,"sun"),this.sun.body=null,this.sun.anchor.setTo(.5,.5),this.sun.scale.setTo(.3,.4),this.sun.x=this.game.world.centerX,this.sun.y=.5*this.game.world.centerY-100,e=this.game.add.tween(this.sun.scale),e.to({x:1.5,y:1.5},45e4/i,Phaser.Easing.Cubic.InOut,!0,0,999,!0),e.start,n=this.game.add.tween(this.sun),n.to({y:675},45e4/i,Phaser.Easing.Sinusoidal.InOut,!0,0,999,!0),n.start,t=this.game.add.tween(this.sun),t.to({alpha:0},45e4/i,Phaser.Easing.Linear.None,!0,0,!0,!0),t.start,this.cloud=this.game.add.sprite(1e3,70,"cloud"),this.cloud.body=null,this.cloud.alpha=.4,s=this.game.add.tween(this.cloud),s.to({x:-800},7e4/i,Phaser.Easing.Linear.None,!0,0,999),s.start,this.mountain0a=this.game.add.sprite(0,180,"mountain0"),this.mountain0a.body=null,this.mountain0b=this.game.add.sprite(2e3,180,"mountain0"),this.mountain0b.body=null,this.player_group=this.game.add.group(),this.coin=this.game.add.sprite(400,250,"coin"),this.coin.body=null,this.coin.anchor.setTo(.5,.5),this.coin.animations.add("spin",[0,1,2,3,4,5],10,!0),this.coin.animations.play("spin"),this.bomb=this.game.add.sprite(450,250,"bomb"),this.bomb.body=null,this.bomb.anchor.setTo(.5,.5),this.bomb.animations.add("pulse",[0,1,2,3,4,5],10,!0),this.bomb.animations.play("pulse"),this.mountain1a=this.game.add.sprite(0,180,"mountain1"),this.mountain1a.body=null,this.mountain1b=this.game.add.sprite(2e3,180,"mountain1"),this.mountain1b.body=null,this.heightmap=[],h=122,o=d=0,u=this.mountain1a.width;u>=0?u>=d:d>=u;o=u>=0?++d:--d){if(r=this.mountain1a.input.checkPixel(o,h)){for(;r;)h-=1,r=this.mountain1a.input.checkPixel(o,h);h+=1}else for(;!(r||(h+=1,r=this.mountain1a.input.checkPixel(o,h),h>200)););this.heightmap.push(h)}return this.mountain2a=this.game.add.sprite(0,180,"mountain2"),this.mountain2a.body=null,this.mountain2b=this.game.add.sprite(2e3,180,"mountain2"),this.mountain2b.body=null,this.mountain3a=this.game.add.sprite(0,180,"mountain3"),this.mountain3a.body=null,this.mountain3a.alpha=.4,this.mountain3b=this.game.add.sprite(2e3,180,"mountain3"),this.mountain3b.body=null,this.mountain3b.alpha=.4,this.avatar_group=this.game.add.group(),this.explosion=this.game.add.sprite(500,250,"explosion"),this.explosion.anchor.setTo(.5,.5),this.explosion.animations.add("bang",[0,1,2,3],4,!1),this.explosion.animations.play("bang",4,!1,!0),this.tree0=this.game.add.sprite(2e3,490,"tree0"),this.tree0.body=null,this.tree0.anchor.setTo(.5,1),s=this.game.add.tween(this.tree0),s.to({x:-2e3},3400/i,Phaser.Easing.Linear.None,!0,3e3/i,999),s.start,this.tree1=this.game.add.sprite(2e3,490,"tree1"),this.tree1.body=null,this.tree1.anchor.setTo(.5,1),s=this.game.add.tween(this.tree1),s.to({x:-2e3},3500/i,Phaser.Easing.Linear.None,!0,7e3/i,999),s.start,this.tree2=this.game.add.sprite(2e3,490,"tree2"),this.tree2.body=null,this.tree2.anchor.setTo(.5,1),s=this.game.add.tween(this.tree2),s.to({x:-2e3},3600/i,Phaser.Easing.Linear.None,!0,13e3/i,999),s.start,this.tree3=this.game.add.sprite(2e3,490,"tree3"),this.tree3.body=null,this.tree3.anchor.setTo(.5,1),s=this.game.add.tween(this.tree3),s.to({x:-2e3},3400/i,Phaser.Easing.Linear.None,!0,17e3/i,999),s.start,this.grass1=this.game.add.sprite(0,380,"grass"),this.grass1.body=null,this.grass2=this.game.add.sprite(896,380,"grass"),this.grass2.body=null,this.label_group=this.game.add.group(),this.position=0,this.players={},this.addPlayer(window.laggydash.user.replace(/:.*$/,""),this.game.player_name,!0),a=this.game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR),a.onDown.add(this.jump),this.game.input.onTap.add(this.jump),this.current=null,this.timer=this.game.time.create(),this.timer.start()},e.prototype.update=function(){var t,e;return this.position+=1,this.grass1.x-=20*i,this.grass2.x-=20*i,this.grass1.x<=-896&&(this.grass1.x+=1792),this.grass2.x<=-896&&(this.grass2.x+=1792),this.mountain0a.x-=1.1*i,this.mountain0b.x-=1.1*i,this.mountain0a.x<=-2e3&&(this.mountain0a.x+=4e3),this.mountain0b.x<=-2e3&&(this.mountain0b.x+=4e3),this.mountain1a.x-=1.7*i,this.mountain1b.x-=1.7*i,this.mountain1a.x<=-2e3&&(this.mountain1a.x+=4e3),this.mountain1b.x<=-2e3&&(this.mountain1b.x+=4e3),this.mountain2a.x-=2.3*i,this.mountain2b.x-=2.3*i,this.mountain2a.x<=-2e3&&(this.mountain2a.x+=4e3),this.mountain2b.x<=-2e3&&(this.mountain2b.x+=4e3),this.mountain3a.x-=2.9*i,this.mountain3b.x-=2.9*i,this.mountain3a.x<=-2e3&&(this.mountain3a.x+=4e3),this.mountain3b.x<=-2e3&&(this.mountain3b.x+=4e3),t=Math.round(Math.min(this.mountain1a.x,this.mountain1b.x)),this.player_group.forEachAlive(function(e){return function(a){var i,s,n,r,o;return a.dot.y=a.avatar.y-a.avatar.height-5,a.dot.height=a.dot.y-a.y-8,r=(a.x-t)%2e3,o=e.heightmap[Math.round(r)]+e.mountain1a.y,n=a.onGround,i=a.y-o,a.onGround=i>0,-20>i&&(a.jump=!1),a.onGround&&(a.y=o,a.body.velocity.y=0,a.jump&&(a.jump=!1,a.onGround=!1,a.y-=10,a.body.velocity.y=-200,a.animations.stop(),a.frame="runner"===a.key?4:2)),!n&&a.onGround&&a.play("run"),"wolf"===a.key&&a.x===a.target&&a.onGround?(a.target=e.game.rnd.integerInRange(100,500),s=e.game.add.tween(a),s.to({x:a.target},e.game.rnd.realInRange(3e3,8e3),Phaser.Easing.Sinusoidal.InOut,!1,e.game.rnd.realInRange(0,1e4)),s.start()):void 0}}(this)),null!=this.current&&(e=this.players[this.current],e.avatar.x=e.runner.x,e.runner.dot.x=e.runner.x,e.label.x=e.runner.x-e.label.width/2),null!=this.prev?(e=this.players[this.prev],e.avatar.x=e.runner.x,e.runner.dot.x=e.runner.x,e.label.x=e.runner.x-e.label.width/2):void 0},e.prototype.jump=function(){return this.player_group.forEachAlive(function(){return function(t){return"runner"===t.key?(t.jump=!0,window.laggydash.send({action:"jump"})):void 0}}(this))},e.prototype.addPlayer=function(t,e,a){var i,s,n,r,o,h,d,u,l,g;return null==a&&(a=!1),g=a?600:this.game.rnd.integerInRange(100,500),u=a?"runner":"wolf",n=a?8:12,h=a?.9:1,d=this.game.add.sprite(g,0,u),d.animations.add("run",[0,1,2,3,4,5],n,!0),d.anchor.setTo(.5,h),d.onGround=!1,d.jump=!1,d.frame=a?3:4,d.target=g,d.id=t,this.player_group.add(d),i=this.game.add.sprite(g,475,"@"+e),i.body=null,i.id=t,i.name=e,i.width=60,i.height=60,i.anchor.setTo(.5,1),i.alpha=0,i.inputEnabled=!0,i.useHandCursor=!0,i.events.onInputDown.add(function(){return function(){return i.alpha>.5?window.laggydash.showUser(e):void 0}}(this)),this.avatar_group.add(i),s=this.game.add.sprite(g,i.y,"dot"),s.body=null,s.id=t,s.height=100,s.anchor.setTo(.5,1),s.alpha=0,d.dot=s,d.avatar=i,this.avatar_group.add(s),l={font:"10pt Courier",fill:"#ffffff"},o=this.game.add.text(g,480,"@"+e,l),o.x-=o.width/2,o.alpha=0,this.label_group.add(o),a?(r=this.game.add.tween(i),r.to({alpha:.8},1e3,Phaser.Easing.Linear.None,!0,2e3),r.start,r=this.game.add.tween(s),r.to({alpha:.3},1e3,Phaser.Easing.Linear.None,!0,2e3),r.start,r=this.game.add.tween(o),r.to({alpha:1},1e3,Phaser.Easing.Linear.None,!0,2e3),r.start):this.players[t]={runner:d,avatar:i,label:o}},e.prototype.showPlayer=function(){var t,e,a,i,s,n,r;if(a=_.keys(this.players),0===a.length)return this.current=null,this.prev=null,void 0;for(null!=this.current&&a.length>1&&(this.prev=this.current,a=_.without(a,this.current),i=this.players[this.current],e=this.game.add.tween(i.avatar),e.to({alpha:0},1e3,Phaser.Easing.Linear.None,!0),e.start,e=this.game.add.tween(i.runner.dot),e.to({alpha:0},1e3,Phaser.Easing.Linear.None,!0),e.start,e=this.game.add.tween(i.label),e.to({alpha:0},1e3,Phaser.Easing.Linear.None,!0),e.start),this.current=this.game.rnd.pick(a),i=this.players[this.current],e=this.game.add.tween(i.avatar),e.to({alpha:.8},1e3,Phaser.Easing.Linear.None,!0,500),e.start,e=this.game.add.tween(i.runner.dot),e.to({alpha:.3},1e3,Phaser.Easing.Linear.None,!0,500),e.start,e=this.game.add.tween(i.label),e.to({alpha:1},1e3,Phaser.Easing.Linear.None,!0,500),e.start,r=this.timer.events,s=0,n=r.length;n>s;s++)t=r[s],this.timer.remove(t);return this.timer.add(8e3,this.showPlayer)},e.prototype.delPlayer=function(t){return null!=this.players[t]?(this.players[t].runner.dot.destroy(),this.players[t].runner.destroy(),this.players[t].avatar.destroy(),this.players[t].label.destroy(),delete this.players[t],this.current===t&&(this.current=null,this.showPlayer()),this.prev===t?this.prev=null:void 0):void 0},e.prototype.avatarLoaded=function(t){return this.avatar_group.forEach(function(){return function(e){return"__missing"===e.key&&t==="@"+e.name?(e.loadTexture(t),e.width=60,e.height=60):void 0}}(this))},e.prototype.handle=function(t){switch(t.action){case"join":if(this.addPlayer(t.id,t.name),null===this.current)return this.showPlayer();break;case"bail":return this.delPlayer(t.id);case"jump":return this.player_group.forEachAlive(function(){return function(e){return e.id===t.id?e.jump=!0:void 0}}(this))}},e.prototype.delMob=function(t,e){return console.log("ADD "+e)},e.prototype.destroy=function(){return destroy(this.tree0),destroy(this.tree1),destroy(this.tree2),destroy(this.tree3),destroy(this.night),destroy(this.sky),destroy(this.sun),destroy(this.cloud),destroy(this.grass1),destroy(this.grass2),destroy(this.runner)},e.prototype.done=function(){return this.game.state.start("splash")},e}(Phaser.State),t.Landscape=e}.call(this),function(){var t,e,a,i,s=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty,r=function(t,e){function a(){this.constructor=t}for(var i in e)n.call(e,i)&&(t[i]=e[i]);return a.prototype=e.prototype,t.prototype=new a,t.__super__=e.prototype,t};t=window.LaggyDash,i=t.Splash,e=t.Landscape,a=function(t){function a(t){this.parent=null!=t?t:"",this._message=s(this._message,this),this._presence=s(this._presence,this),this.startGame=s(this.startGame,this),this.ready=s(this.ready,this)}return r(a,t),a.prototype.run=function(t){var e;return null==t&&(t=!1),e=t?Phaser.CANVAS:Phaser.AUTO,new Phaser.Game(896,504,e,this.parent,this)},a.prototype.destroy=function(){return destroy(this.text),destroy(this.graphics)},a.prototype.preload=function(){var t,a;return this.game.stage.disableVisibilityChange=!0,this.game.stage.scale.pageAlignHorizontally=!0,this.game.stage.scale.pageAlignVertically=!1,this.game.stage.scale.setShowAll(),this.game.stage.scale.refresh(),this.game.stage.scale.enterLandscape.add(function(t){return function(){return t.game.stage.scale.setShowAll(),t.game.stage.scale.refresh()}}(this)),this.game.stage.scale.enterPortrait.add(function(t){return function(){return t.game.stage.scale.setShowAll(),t.game.stage.scale.refresh()}}(this)),this.setPlayerName(location.search),this.game.physics.gravity.y=400,t="=== L A G G Y D A S H ===\nis\nLOADING",a={font:"30px Courier",fill:"#00ff44",align:"center"},this.text=this.game.add.text(this.game.world.centerX,this.game.world.centerY,t,a),this.text.anchor.setTo(.5,.5),this.graphics=this.game.add.graphics(0,0),this.graphics.lineStyle(1,5605580,1),this.graphics.drawRect(199,339,502,22),this.game.load.onLoadComplete.addOnce(this.ready),this.game.state.add("splash",new i,!1),this.game.state.add("landscape",new e,!1),this.game.load.image("labs","images/labs-6e6507d0.png"),this.game.load.image("night","images/night_sky-536d3c4e.png"),this.game.load.image("stars","images/night_stars-db528057.png"),this.game.load.image("sky","images/sky-7c5c1b96.jpg"),this.game.load.image("sun","images/sun-9189a743.png"),this.game.load.image("cloud","images/cloud-16060b57.png"),this.game.load.image("mountain0","images/mountain0-f8f2cbad.png"),this.game.load.image("mountain1","images/mountain1-8de3a136.png"),this.game.load.image("mountain2","images/mountain2-1d8dfe88.png"),this.game.load.image("mountain3","images/mountain3-baf33425.png"),this.game.load.image("grass","images/grass-d6b8cba6.png"),this.game.load.image("tree0","images/tree0-23f3bb56.png"),this.game.load.image("tree1","images/tree1-769d4031.png"),this.game.load.image("tree2","images/tree2-646e82b2.png"),this.game.load.image("tree3","images/tree3-514f4f08.png"),this.game.load.image("dot","images/dot-309749be.png"),this.game.load.spritesheet("runner","images/running-cb59ff48.png",44,64,6),this.game.load.spritesheet("wolf","images/wolf-aa062f94.png",64,32,6),this.game.load.spritesheet("coin","images/coin-28be484f.png",16,18,6),this.game.load.spritesheet("bomb","images/bomb-3e619ff7.png",18,18,6),this.game.load.spritesheet("explosion","images/explosion-5fb4e372.png",32,32,4)},a.prototype.loadRender=function(){return this.graphics.beginFill(65348),this.graphics.drawRect(200,340,5*this.game.load.progress,20),this.graphics.endFill()},a.prototype.render=function(){return this.graphics.clear(),this.game.load.hasLoaded?void 0:this.loadRender()},a.prototype.ready=function(){var t,e;return this.game.load.onFileComplete.add(function(t){return function(e,a){return t.onAvatarLoaded(a)}}(this)),this.text.alpha=0,null!=this.game.player_name?this.startGame():(t="Your Twitter Handle (so we can show you in the game)",e={labels:{ok:"Play",cancel:"Surprise Me"}},alertify.set(e),alertify.prompt(t,function(t){return function(e,a){return e&&t.setPlayerName(a),null==t.game.player_name&&t.randomPlayerName(),t.startGame()}}(this)))},a.prototype.setPlayerName=function(t){return null!=t?(this.game.player_name=t.replace(/[^a-z0-9_]/i,"").toLowerCase(),this.game.player_name.length<1||this.game.player_name.length>15?this.game.player_name=null:void 0):void 0},a.prototype.randomPlayerName=function(){var t,e;return t=["BarackObama","Eminem","BillGates","ParisHilton","ConanOBrien","tomhanks","TheRock","stephenfry","MichelleObama"],e=this.game.rnd.pick(t),this.setPlayerName(e)},a.prototype.startGame=function(){return this.game.state.start("splash")},a.prototype.connect=function(t,e){return this.channel=t,this.user=e,this.pubnub=PUBNUB.init({publish_key:"pub-c-e5d7da60-f65b-4173-b353-2b06890cfe5b",subscribe_key:"sub-c-4cf670be-96d5-11e3-b9e1-02ee2ddab7fe",uuid:this.user}),this.pubnub.subscribe({channel:t,message:this._message,presence:this._presence})},a.prototype.send=function(t){return this.pubnub.publish({channel:this.channel,message:{uuid:this.user,data:t}})},a.prototype.loadAvatar=function(t){var e;if(e="@"+t,this.game.cache.checkImageKey(e)||this.game.load.checkKeyExists("image",e));else if(this.game.load.image(e,"http://res.cloudinary.com/kranzky/image/twitter_name/"+t+".jpg"),!this.game.load.isLoading)return this.game.load.start()},a.prototype.onAvatarLoaded=function(t){return"landscape"===laggydash.game.state.current?this.game.state.getCurrentState().avatarLoaded(t):void 0},a.prototype.showUser=function(t){return this.openWindow("https://twitter.com/intent/user?screen_name="+t)},a.prototype.tweet=function(t,e){var a,i;return i=encodeURI("http://laggydash.com/"),t=encodeURI(t),a=encodeURI(e.toString()),this.openWindow("https://twitter.com/intent/tweet?text="+t+"&hashtags=laggydash&url="+i+"&related="+a+"&")},a.prototype.openWindow=function(t){var e,a,i,s,n;return n="scrollbars=yes,resizable=yes,toolbar=no,location=yes",s=550,e=420,a=Math.round(screen.width/2-s/2),i=0,screen.height>e&&(i=Math.round(screen.height/2-e/2)),window.open(t,"intent",""+n+",width="+s+",height="+e+",left="+a+",top="+i)},a.prototype._presence=function(t){var e,a;if(a=t.uuid.replace(/:.*$/i,""),e=t.uuid.replace(/^.*:/i,""),t.uuid!==this.user)switch(t.action){case"join":this._handle({id:a,action:"join",name:e}),alertify.success("@"+e+" has joined");break;case"leave":this._handle({id:a,action:"bail",name:e}),alertify.error("@"+e+" has bailed")}return(t.action="join")?this.loadAvatar(e):void 0},a.prototype._message=function(t){var e,a;if(t.uuid!==this.user)return a=t.uuid.replace(/:.*$/i,""),e=t.uuid.replace(/^.*:/i,""),t.data.id=a,t.data.name=e,this._handle(t.data)},a.prototype._handle=function(t){return"landscape"===laggydash.game.state.current?this.game.state.getCurrentState().handle(t):void 0},a}(Phaser.State),t.Main=a}.call(this),function(){}.call(this);